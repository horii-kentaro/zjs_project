<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çµ±åˆãƒ†ã‚¹ãƒˆå…¥é–€ã‚¬ã‚¤ãƒ‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans JP', sans-serif;
            background: #f6f8fa;
            color: #24292f;
            line-height: 1.6;
            padding: 20px;
        }
        .container {
            max-width: 1100px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #24292f;
            margin-bottom: 10px;
            font-size: 28px;
        }
        .subtitle {
            text-align: center;
            color: #57606a;
            margin-bottom: 30px;
        }
        
        .section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .section h2 {
            color: #24292f;
            font-size: 20px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #2da44e;
        }
        .section h2.pytest { border-bottom-color: #0a9396; }
        .section h2.fixture { border-bottom-color: #8250df; }
        .section h2.factory { border-bottom-color: #bf8700; }
        .section h2.integration { border-bottom-color: #cf222e; }
        .section h2.efficiency { border-bottom-color: #0969da; }
        .section h3 {
            color: #24292f;
            font-size: 16px;
            margin: 24px 0 12px;
        }
        
        /* ãƒ†ãƒ¼ãƒ–ãƒ« */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border: 1px solid #d0d7de;
        }
        th {
            background: #f6f8fa;
            font-weight: 600;
        }
        
        /* ãƒœãƒƒã‚¯ã‚¹é¡ */
        .point-box {
            background: #ddf4ff;
            border: 1px solid #54aeff;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        .point-box h4 {
            color: #0969da;
            margin-bottom: 8px;
        }
        .point-box ul, .point-box ol {
            margin-left: 20px;
        }
        .point-box li {
            margin: 4px 0;
        }
        
        .callout {
            background: #fff8c5;
            border: 1px solid #d4a72c;
            border-radius: 8px;
            padding: 12px 16px;
            margin: 12px 0;
            font-size: 14px;
        }
        .callout::before {
            content: "ğŸ’¡";
            margin-right: 8px;
        }
        
        .recommend-box {
            background: #dafbe1;
            border: 1px solid #2da44e;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        .recommend-box h4 {
            color: #1a7f37;
            margin-bottom: 8px;
        }
        
        .warning-box {
            background: #ffebe9;
            border: 1px solid #ff8182;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        .warning-box h4 {
            color: #cf222e;
            margin-bottom: 8px;
        }
        
        .beginner-box {
            background: #f0f7ff;
            border: 2px solid #0969da;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        .beginner-box h4 {
            color: #0969da;
            margin-bottom: 8px;
        }
        .beginner-box h4::before {
            content: "ğŸ”° ";
        }
        
        /* ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ */
        .code-block {
            background: #24292f;
            color: #e6edf3;
            padding: 16px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            margin: 16px 0;
            line-height: 1.5;
        }
        .code-block .comment {
            color: #8b949e;
        }
        .code-block .keyword {
            color: #ff7b72;
        }
        .code-block .string {
            color: #a5d6ff;
        }
        .code-block .function {
            color: #d2a8ff;
        }
        .code-block .number {
            color: #79c0ff;
        }
        .code-block .decorator {
            color: #ffa657;
        }
        .code-block .class {
            color: #7ee787;
        }
        .code-block .builtin {
            color: #79c0ff;
        }
        
        .command-block {
            background: #1e1e2e;
            border-left: 4px solid #2da44e;
            color: #cdd6f4;
            padding: 16px;
            border-radius: 0 8px 8px 0;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 14px;
            margin: 16px 0;
        }
        .command-block .prompt {
            color: #a6e3a1;
        }
        .command-block .output {
            color: #6c7086;
        }
        .command-block .success {
            color: #a6e3a1;
        }
        .command-block .fail {
            color: #f38ba8;
        }
        
        code {
            background: #f6f8fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 12px;
        }
        
        /* ãƒ”ãƒ©ãƒŸãƒƒãƒ‰å›³ */
        .pyramid-container {
            display: flex;
            justify-content: center;
            margin: 30px 0;
        }
        .pyramid {
            position: relative;
            width: 400px;
        }
        .pyramid-level {
            text-align: center;
            padding: 16px;
            color: white;
            font-weight: 600;
            position: relative;
        }
        .pyramid-level.e2e {
            background: #cf222e;
            width: 40%;
            margin: 0 auto;
            border-radius: 4px 4px 0 0;
        }
        .pyramid-level.integration {
            background: #bf8700;
            width: 70%;
            margin: 0 auto;
        }
        .pyramid-level.unit {
            background: #2da44e;
            width: 100%;
            border-radius: 0 0 4px 4px;
        }
        .pyramid-label {
            position: absolute;
            right: -180px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            color: #57606a;
            width: 160px;
            text-align: left;
        }
        .pyramid-label-left {
            position: absolute;
            left: -120px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            color: #57606a;
            width: 100px;
            text-align: right;
        }
        
        /* æ¯”è¼ƒå›³ */
        .compare-diagram {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .compare-side {
            background: #f6f8fa;
            border-radius: 8px;
            padding: 20px;
        }
        .compare-side.bad {
            background: #ffebe9;
            border: 1px solid #ff8182;
        }
        .compare-side.good {
            background: #dafbe1;
            border: 1px solid #2da44e;
        }
        .compare-side h4 {
            text-align: center;
            margin-bottom: 16px;
        }
        
        /* ãƒ•ãƒ­ãƒ¼å›³ */
        .flow-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        .flow-step {
            background: white;
            border: 2px solid #d0d7de;
            border-radius: 8px;
            padding: 12px 16px;
            text-align: center;
            min-width: 100px;
        }
        .flow-step.highlight {
            background: #ddf4ff;
            border-color: #0969da;
        }
        .flow-step.success {
            background: #dafbe1;
            border-color: #2da44e;
        }
        .flow-arrow {
            font-size: 20px;
            color: #57606a;
        }
        
        /* ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ */
        .file-tree {
            background: #f6f8fa;
            border-radius: 8px;
            padding: 16px;
            font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
            font-size: 13px;
        }
        .file-tree .folder {
            color: #0969da;
        }
        .file-tree .file {
            color: #24292f;
        }
        .file-tree .comment {
            color: #57606a;
        }
        
        /* æ™‚é–“æ¯”è¼ƒ */
        .time-bar {
            display: flex;
            align-items: center;
            margin: 8px 0;
        }
        .time-bar-label {
            width: 120px;
            font-size: 13px;
        }
        .time-bar-visual {
            flex: 1;
            height: 24px;
            background: #e6edf3;
            border-radius: 4px;
            overflow: hidden;
        }
        .time-bar-fill {
            height: 100%;
            display: flex;
            align-items: center;
            padding-left: 8px;
            color: white;
            font-size: 12px;
            font-weight: 600;
        }
        .time-bar-fill.slow { background: #cf222e; }
        .time-bar-fill.medium { background: #bf8700; }
        .time-bar-fill.fast { background: #2da44e; }

        @media (max-width: 768px) {
            .compare-diagram {
                grid-template-columns: 1fr;
            }
            .pyramid-label, .pyramid-label-left {
                display: none;
            }
        }

        @media print {
            body { background: white; }
            .section { box-shadow: none; border: 1px solid #ddd; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª çµ±åˆãƒ†ã‚¹ãƒˆå…¥é–€ã‚¬ã‚¤ãƒ‰</h1>
        <p class="subtitle">åŠ¹ç‡çš„ã§æ±ç”¨æ€§ã®é«˜ã„ãƒ†ã‚¹ãƒˆæˆ¦ç•¥</p>

        <!-- æ¦‚è¦ -->
        <div class="section">
            <h2>ğŸ“‹ ã“ã®ã‚¬ã‚¤ãƒ‰ã§å­¦ã¹ã‚‹ã“ã¨</h2>
            
            <table>
                <tr>
                    <th style="width: 5%;">#</th>
                    <th style="width: 30%;">ã‚»ã‚¯ã‚·ãƒ§ãƒ³</th>
                    <th>å†…å®¹</th>
                </tr>
                <tr>
                    <td>1</td>
                    <td>ãƒ†ã‚¹ãƒˆã®ç¨®é¡ã¨é•ã„</td>
                    <td>å˜ä½“ãƒ»çµ±åˆãƒ»E2Eãƒ†ã‚¹ãƒˆã®å½¹å‰²ã¨ä½¿ã„åˆ†ã‘</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>ãƒ†ã‚¹ãƒˆãƒ”ãƒ©ãƒŸãƒƒãƒ‰æˆ¦ç•¥</td>
                    <td>åŠ¹ç‡çš„ãªãƒ†ã‚¹ãƒˆé…åˆ†ã®è€ƒãˆæ–¹</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>pytest ã®åŸºæœ¬</td>
                    <td>Pythonãƒ†ã‚¹ãƒˆã®æ¨™æº–ãƒ„ãƒ¼ãƒ«</td>
                </tr>
                <tr>
                    <td>4</td>
                    <td>Fixtureï¼ˆãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ï¼‰</td>
                    <td>ãƒ†ã‚¹ãƒˆã®å‰æº–å‚™ã‚’è‡ªå‹•åŒ–ãƒ»å†åˆ©ç”¨</td>
                </tr>
                <tr>
                    <td>5</td>
                    <td>Factory Boy</td>
                    <td>ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•ç”Ÿæˆ</td>
                </tr>
                <tr>
                    <td>6</td>
                    <td>çµ±åˆãƒ†ã‚¹ãƒˆã®å®Ÿè£…</td>
                    <td>APIãƒ»DBé€£æºã®ãƒ†ã‚¹ãƒˆæ–¹æ³•</td>
                </tr>
                <tr>
                    <td>7</td>
                    <td>åŠ¹ç‡åŒ–ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯</td>
                    <td>ä¸¦åˆ—å®Ÿè¡Œãƒ»ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ»CIé€£æº</td>
                </tr>
                <tr>
                    <td>8</td>
                    <td>æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®é©ç”¨</td>
                    <td>è„†å¼±æ€§ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã§ã®å…·ä½“ä¾‹</td>
                </tr>
            </table>
            
            <div class="point-box">
                <h4>ğŸ¯ ã“ã®ã‚¬ã‚¤ãƒ‰ã®ã‚´ãƒ¼ãƒ«</h4>
                <ul>
                    <li><strong>åŠ¹ç‡çš„</strong>ï¼šæœ€å°ã®åŠ´åŠ›ã§æœ€å¤§ã®å“è³ªä¿è¨¼</li>
                    <li><strong>æ±ç”¨çš„</strong>ï¼šä»Šå¾Œã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚‚ä½¿ã„å›ã›ã‚‹ä»•çµ„ã¿</li>
                    <li><strong>è‡ªå‹•åŒ–</strong>ï¼šæ‰‹å‹•ãƒ†ã‚¹ãƒˆã‚’ã‚¼ãƒ­ã«è¿‘ã¥ã‘ã‚‹</li>
                </ul>
            </div>
        </div>

        <!-- ãƒ†ã‚¹ãƒˆã®ç¨®é¡ -->
        <div class="section">
            <h2>ğŸ” 1. ãƒ†ã‚¹ãƒˆã®ç¨®é¡ã¨é•ã„</h2>
            
            <h3>3ç¨®é¡ã®ãƒ†ã‚¹ãƒˆ</h3>
            <table>
                <tr>
                    <th style="width: 20%;">ç¨®é¡</th>
                    <th style="width: 25%;">ãƒ†ã‚¹ãƒˆå¯¾è±¡</th>
                    <th style="width: 25%;">ä¾‹</th>
                    <th>ç‰¹å¾´</th>
                </tr>
                <tr>
                    <td><strong>å˜ä½“ãƒ†ã‚¹ãƒˆ</strong><br>(Unit Test)</td>
                    <td>1ã¤ã®é–¢æ•°ãƒ»ã‚¯ãƒ©ã‚¹</td>
                    <td>ã€ŒCVSSã‚¹ã‚³ã‚¢ã‹ã‚‰é‡è¦åº¦ã‚’åˆ¤å®šã™ã‚‹é–¢æ•°ã€</td>
                    <td>âš¡ é«˜é€Ÿã€ğŸ¯ ç¯„å›²ãŒç‹­ã„</td>
                </tr>
                <tr>
                    <td><strong>çµ±åˆãƒ†ã‚¹ãƒˆ</strong><br>(Integration Test)</td>
                    <td>è¤‡æ•°ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®é€£æº</td>
                    <td>ã€ŒAPIãŒDBã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦è¿”ã™ã€</td>
                    <td>â±ï¸ ä¸­é€Ÿã€ğŸ”— é€£æºã‚’ç¢ºèª</td>
                </tr>
                <tr>
                    <td><strong>E2Eãƒ†ã‚¹ãƒˆ</strong><br>(End-to-End)</td>
                    <td>ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“</td>
                    <td>ã€Œãƒ–ãƒ©ã‚¦ã‚¶ã§è„†å¼±æ€§ã‚’æ¤œç´¢ã—ã¦çµæœè¡¨ç¤ºã€</td>
                    <td>ğŸ¢ ä½é€Ÿã€ğŸŒ ç¾å®Ÿã«è¿‘ã„</td>
                </tr>
            </table>
            
            <h3>å…·ä½“ä¾‹ã§ç†è§£ã™ã‚‹</h3>
            <div class="code-block">
<span class="comment"># ã€å˜ä½“ãƒ†ã‚¹ãƒˆã€‘é–¢æ•°å˜ä½“ã‚’ãƒ†ã‚¹ãƒˆ</span>
<span class="keyword">def</span> <span class="function">test_calculate_severity</span>():
    <span class="keyword">assert</span> calculate_severity(<span class="number">9.5</span>) == <span class="string">"Critical"</span>
    <span class="keyword">assert</span> calculate_severity(<span class="number">7.0</span>) == <span class="string">"High"</span>
    <span class="keyword">assert</span> calculate_severity(<span class="number">4.0</span>) == <span class="string">"Medium"</span>

<span class="comment"># ã€çµ±åˆãƒ†ã‚¹ãƒˆã€‘API + DB ã®é€£æºã‚’ãƒ†ã‚¹ãƒˆ</span>
<span class="keyword">def</span> <span class="function">test_get_vulnerabilities_api</span>(client, db_session):
    <span class="comment"># DBã«ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥</span>
    vuln = Vulnerability(cve_id=<span class="string">"CVE-2024-1234"</span>, severity=<span class="string">"Critical"</span>)
    db_session.add(vuln)
    db_session.commit()
    
    <span class="comment"># APIã‚’å‘¼ã³å‡ºã—</span>
    response = client.get(<span class="string">"/api/vulnerabilities"</span>)
    
    <span class="comment"># ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’æ¤œè¨¼</span>
    <span class="keyword">assert</span> response.status_code == <span class="number">200</span>
    <span class="keyword">assert</span> response.json()[<span class="number">0</span>][<span class="string">"cve_id"</span>] == <span class="string">"CVE-2024-1234"</span>

<span class="comment"># ã€E2Eãƒ†ã‚¹ãƒˆã€‘ãƒ–ãƒ©ã‚¦ã‚¶ã§å®Ÿéš›ã«æ“ä½œ</span>
<span class="keyword">def</span> <span class="function">test_search_vulnerability_e2e</span>(browser):
    browser.goto(<span class="string">"http://localhost:3000"</span>)
    browser.fill(<span class="string">"input[name='search']"</span>, <span class="string">"CVE-2024-1234"</span>)
    browser.click(<span class="string">"button[type='submit']"</span>)
    <span class="keyword">assert</span> browser.text_content(<span class="string">".result"</span>) == <span class="string">"CVE-2024-1234"</span>
            </div>
            
            <div class="beginner-box">
                <h4>ã©ã‚Œã‚’å„ªå…ˆã™ã¹ãï¼Ÿ</h4>
                <p>
                    <strong>çµ±åˆãƒ†ã‚¹ãƒˆ</strong>ãŒæœ€ã‚‚è²»ç”¨å¯¾åŠ¹æœãŒé«˜ã„ã§ã™ã€‚<br>
                    å˜ä½“ãƒ†ã‚¹ãƒˆã ã‘ã§ã¯ã€Œé€£æºéƒ¨åˆ†ã®ãƒã‚°ã€ã‚’è¦‹ã¤ã‘ã‚‰ã‚Œãšã€<br>
                    E2Eãƒ†ã‚¹ãƒˆã ã‘ã§ã¯ã€Œé…ã™ãã¦ã€é–‹ç™ºåŠ¹ç‡ãŒè½ã¡ã¾ã™ã€‚
                </p>
            </div>
        </div>

        <!-- ãƒ†ã‚¹ãƒˆãƒ”ãƒ©ãƒŸãƒƒãƒ‰ -->
        <div class="section">
            <h2>ğŸ”º 2. ãƒ†ã‚¹ãƒˆãƒ”ãƒ©ãƒŸãƒƒãƒ‰æˆ¦ç•¥</h2>
            
            <p style="margin-bottom: 20px;">
                ãƒ†ã‚¹ãƒˆã¯<strong>ã€Œãƒ”ãƒ©ãƒŸãƒƒãƒ‰å‹ã€</strong>ã®é…åˆ†ãŒåŠ¹ç‡çš„ã§ã™ã€‚
            </p>
            
            <div class="pyramid-container">
                <div class="pyramid">
                    <div class="pyramid-level e2e">
                        E2Eãƒ†ã‚¹ãƒˆ
                        <span class="pyramid-label">å°‘æ•°ï¼ˆ5ã€œ10ä»¶ï¼‰<br>é‡è¦ã‚·ãƒŠãƒªã‚ªã®ã¿</span>
                        <span class="pyramid-label-left">ğŸ¢ é…ã„<br>ğŸ’° é«˜ã‚³ã‚¹ãƒˆ</span>
                    </div>
                    <div class="pyramid-level integration">
                        çµ±åˆãƒ†ã‚¹ãƒˆ
                        <span class="pyramid-label">ä¸­ç¨‹åº¦ï¼ˆ50ã€œ100ä»¶ï¼‰<br>APIãƒ»DBé€£æº</span>
                        <span class="pyramid-label-left">â±ï¸ ä¸­é€Ÿ</span>
                    </div>
                    <div class="pyramid-level unit">
                        å˜ä½“ãƒ†ã‚¹ãƒˆ
                        <span class="pyramid-label">å¤šæ•°ï¼ˆ200ã€œ500ä»¶ï¼‰<br>é–¢æ•°ãƒ»ã‚¯ãƒ©ã‚¹å˜ä½</span>
                        <span class="pyramid-label-left">âš¡ é«˜é€Ÿ<br>ğŸ’µ ä½ã‚³ã‚¹ãƒˆ</span>
                    </div>
                </div>
            </div>
            
            <h3>æ¨å¥¨é…åˆ†</h3>
            <table>
                <tr>
                    <th>ãƒ†ã‚¹ãƒˆç¨®é¡</th>
                    <th>å‰²åˆ</th>
                    <th>æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç›®å®‰</th>
                    <th>å®Ÿè¡Œæ™‚é–“ç›®å®‰</th>
                </tr>
                <tr>
                    <td>å˜ä½“ãƒ†ã‚¹ãƒˆ</td>
                    <td>70%</td>
                    <td>100ã€œ200ä»¶</td>
                    <td>10ç§’ä»¥å†…</td>
                </tr>
                <tr>
                    <td><strong>çµ±åˆãƒ†ã‚¹ãƒˆ</strong></td>
                    <td><strong>20%</strong></td>
                    <td><strong>30ã€œ50ä»¶</strong></td>
                    <td><strong>1ã€œ2åˆ†</strong></td>
                </tr>
                <tr>
                    <td>E2Eãƒ†ã‚¹ãƒˆ</td>
                    <td>10%</td>
                    <td>5ã€œ10ä»¶</td>
                    <td>3ã€œ5åˆ†</td>
                </tr>
            </table>
            
            <div class="callout">
                æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯<strong>çµ±åˆãƒ†ã‚¹ãƒˆ</strong>ã«æ³¨åŠ›ã—ã¾ã™ã€‚APIãƒ»DBé€£æºãŒå¤šã„ãŸã‚ã€çµ±åˆãƒ†ã‚¹ãƒˆã§å¤§éƒ¨åˆ†ã®ãƒã‚°ã‚’æ¤œå‡ºã§ãã¾ã™ã€‚
            </div>
            
            <h3>ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“ã®æ¯”è¼ƒ</h3>
            <div style="max-width: 500px;">
                <div class="time-bar">
                    <div class="time-bar-label">å˜ä½“ãƒ†ã‚¹ãƒˆ</div>
                    <div class="time-bar-visual">
                        <div class="time-bar-fill fast" style="width: 10%;">10ç§’</div>
                    </div>
                </div>
                <div class="time-bar">
                    <div class="time-bar-label">çµ±åˆãƒ†ã‚¹ãƒˆ</div>
                    <div class="time-bar-visual">
                        <div class="time-bar-fill medium" style="width: 40%;">1ã€œ2åˆ†</div>
                    </div>
                </div>
                <div class="time-bar">
                    <div class="time-bar-label">E2Eãƒ†ã‚¹ãƒˆ</div>
                    <div class="time-bar-visual">
                        <div class="time-bar-fill slow" style="width: 100%;">5ã€œ10åˆ†</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- pyteståŸºæœ¬ -->
        <div class="section">
            <h2 class="pytest">ğŸ 3. pytest ã®åŸºæœ¬</h2>
            
            <p style="margin-bottom: 20px;">
                <strong>pytest</strong>ã¯Pythonã®æ¨™æº–çš„ãªãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚<br>
                ã‚·ãƒ³ãƒ—ãƒ«ãªæ›¸ãæ–¹ã§å¼·åŠ›ãªãƒ†ã‚¹ãƒˆãŒæ›¸ã‘ã¾ã™ã€‚
            </p>
            
            <h3>ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h3>
            <div class="command-block">
                <span class="prompt">$</span> pip install pytest pytest-cov pytest-xdist
            </div>
            
            <h3>åŸºæœ¬çš„ãªæ›¸ãæ–¹</h3>
            <div class="code-block">
<span class="comment"># tests/test_example.py</span>

<span class="comment"># ãƒ†ã‚¹ãƒˆé–¢æ•°ã¯ test_ ã§å§‹ã‚ã‚‹</span>
<span class="keyword">def</span> <span class="function">test_addition</span>():
    <span class="keyword">assert</span> <span class="number">1</span> + <span class="number">1</span> == <span class="number">2</span>

<span class="keyword">def</span> <span class="function">test_string_contains</span>():
    <span class="keyword">assert</span> <span class="string">"hello"</span> <span class="keyword">in</span> <span class="string">"hello world"</span>

<span class="keyword">def</span> <span class="function">test_list_length</span>():
    items = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]
    <span class="keyword">assert</span> <span class="builtin">len</span>(items) == <span class="number">3</span>

<span class="comment"># ä¾‹å¤–ãŒç™ºç”Ÿã™ã‚‹ã“ã¨ã‚’ãƒ†ã‚¹ãƒˆ</span>
<span class="keyword">import</span> pytest

<span class="keyword">def</span> <span class="function">test_division_by_zero</span>():
    <span class="keyword">with</span> pytest.raises(ZeroDivisionError):
        <span class="number">1</span> / <span class="number">0</span>
            </div>
            
            <h3>ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ</h3>
            <div class="command-block">
                <span class="comment"># å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</span><br>
                <span class="prompt">$</span> pytest<br>
                <br>
                <span class="comment"># ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿</span><br>
                <span class="prompt">$</span> pytest tests/test_api.py<br>
                <br>
                <span class="comment"># ç‰¹å®šãƒ†ã‚¹ãƒˆã®ã¿</span><br>
                <span class="prompt">$</span> pytest tests/test_api.py::test_get_vulnerabilities<br>
                <br>
                <span class="comment"># è©³ç´°è¡¨ç¤º</span><br>
                <span class="prompt">$</span> pytest -v<br>
                <br>
                <span class="comment"># å¤±æ•—ã—ãŸã‚‰å³åœæ­¢</span><br>
                <span class="prompt">$</span> pytest -x
            </div>
            
            <h3>ãƒ†ã‚¹ãƒˆçµæœã®è¦‹æ–¹</h3>
            <div class="command-block">
                <span class="prompt">$</span> pytest -v<br>
                <span class="output">
========================= test session starts =========================
collected 5 items

tests/test_api.py::<span class="success">test_get_vulnerabilities PASSED</span>
tests/test_api.py::<span class="success">test_create_vulnerability PASSED</span>
tests/test_api.py::<span class="fail">test_delete_vulnerability FAILED</span>
tests/test_db.py::<span class="success">test_insert_asset PASSED</span>
tests/test_db.py::<span class="success">test_query_assets PASSED</span>

========================= FAILURES =========================
_________________ test_delete_vulnerability _________________

    def test_delete_vulnerability():
>       assert response.status_code == 204
E       AssertionError: assert 404 == 204

========================= short test summary info =========================
<span class="fail">FAILED</span> tests/test_api.py::test_delete_vulnerability
<span class="success">4 passed</span>, <span class="fail">1 failed</span> in 0.52s
                </span>
            </div>
            
            <div class="beginner-box">
                <h4>è¦šãˆã‚‹ãƒã‚¤ãƒ³ãƒˆ</h4>
                <ul>
                    <li>ãƒ†ã‚¹ãƒˆé–¢æ•°ã¯ <code>test_</code> ã§å§‹ã‚ã‚‹</li>
                    <li><code>assert</code> ã§æœŸå¾…å€¤ã‚’æ¤œè¨¼</li>
                    <li><code>pytest</code> ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œ</li>
                    <li>ç·‘ï¼ˆPASSEDï¼‰ãŒæˆåŠŸã€èµ¤ï¼ˆFAILEDï¼‰ãŒå¤±æ•—</li>
                </ul>
            </div>
        </div>

        <!-- Fixture -->
        <div class="section">
            <h2 class="fixture">ğŸ”§ 4. Fixtureï¼ˆãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ï¼‰</h2>
            
            <p style="margin-bottom: 20px;">
                Fixtureã¯<strong>ãƒ†ã‚¹ãƒˆã®å‰æº–å‚™ã‚’è‡ªå‹•åŒ–ãƒ»å†åˆ©ç”¨</strong>ã™ã‚‹ä»•çµ„ã¿ã§ã™ã€‚<br>
                ä¸€åº¦æ›¸ã‘ã°ã€å…¨ãƒ†ã‚¹ãƒˆã§ä½¿ã„å›ã›ã¾ã™ã€‚
            </p>
            
            <h3>FixtureãŒãªã„å ´åˆã®å•é¡Œ</h3>
            <div class="compare-diagram">
                <div class="compare-side bad">
                    <h4>âŒ Fixtureãªã—</h4>
                    <div class="code-block" style="font-size: 11px;">
<span class="keyword">def</span> <span class="function">test_get_vuln</span>():
    <span class="comment"># æ¯å›åŒã˜æº–å‚™ã‚³ãƒ¼ãƒ‰...</span>
    engine = create_engine(...)
    Session = sessionmaker(...)
    session = Session()
    <span class="comment"># ãƒ†ã‚¹ãƒˆæœ¬ä½“</span>
    ...
    session.close()

<span class="keyword">def</span> <span class="function">test_create_vuln</span>():
    <span class="comment"># ã¾ãŸåŒã˜æº–å‚™ã‚³ãƒ¼ãƒ‰...</span>
    engine = create_engine(...)
    Session = sessionmaker(...)
    session = Session()
    <span class="comment"># ãƒ†ã‚¹ãƒˆæœ¬ä½“</span>
    ...
    session.close()
                    </div>
                    <p style="color: #cf222e; font-weight: 600; margin-top: 8px;">
                        â†’ ã‚³ãƒ¼ãƒ‰ã®é‡è¤‡ã€ä¿®æ­£ãŒå¤§å¤‰
                    </p>
                </div>
                
                <div class="compare-side good">
                    <h4>âœ… Fixtureã‚ã‚Š</h4>
                    <div class="code-block" style="font-size: 11px;">
<span class="decorator">@pytest.fixture</span>
<span class="keyword">def</span> <span class="function">db_session</span>():
    <span class="comment"># æº–å‚™ã¯1ç®‡æ‰€ã ã‘</span>
    session = create_session()
    <span class="keyword">yield</span> session
    session.close()

<span class="keyword">def</span> <span class="function">test_get_vuln</span>(db_session):
    <span class="comment"># å¼•æ•°ã§å—ã‘å–ã‚‹ã ã‘ï¼</span>
    ...

<span class="keyword">def</span> <span class="function">test_create_vuln</span>(db_session):
    <span class="comment"># åŒã˜ãå¼•æ•°ã§å—ã‘å–ã‚‹</span>
    ...
                    </div>
                    <p style="color: #1a7f37; font-weight: 600; margin-top: 8px;">
                        â†’ 1ç®‡æ‰€ã§ç®¡ç†ã€å†åˆ©ç”¨å¯èƒ½
                    </p>
                </div>
            </div>
            
            <h3>åŸºæœ¬çš„ãªFixture</h3>
            <div class="code-block">
<span class="comment"># tests/conftest.py ï¼ˆå…¨ãƒ†ã‚¹ãƒˆã§å…±æœ‰ã•ã‚Œã‚‹Fixtureï¼‰</span>
<span class="keyword">import</span> pytest
<span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine
<span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker
<span class="keyword">from</span> fastapi.testclient <span class="keyword">import</span> TestClient
<span class="keyword">from</span> app.main <span class="keyword">import</span> app
<span class="keyword">from</span> app.database <span class="keyword">import</span> Base, get_db

<span class="comment"># ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹URL</span>
TEST_DATABASE_URL = <span class="string">"postgresql://test:test@localhost:5433/test_db"</span>


<span class="decorator">@pytest.fixture</span>(scope=<span class="string">"session"</span>)
<span class="keyword">def</span> <span class="function">engine</span>():
    <span class="string">"""ãƒ†ã‚¹ãƒˆç”¨DBã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆãƒ†ã‚¹ãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³å…¨ä½“ã§1å›ã ã‘ä½œæˆï¼‰"""</span>
    engine = create_engine(TEST_DATABASE_URL)
    Base.metadata.create_all(bind=engine)  <span class="comment"># ãƒ†ãƒ¼ãƒ–ãƒ«ä½œæˆ</span>
    <span class="keyword">yield</span> engine
    Base.metadata.drop_all(bind=engine)    <span class="comment"># ãƒ†ã‚¹ãƒˆå¾Œã«ãƒ†ãƒ¼ãƒ–ãƒ«å‰Šé™¤</span>


<span class="decorator">@pytest.fixture</span>(scope=<span class="string">"function"</span>)
<span class="keyword">def</span> <span class="function">db_session</span>(engine):
    <span class="string">"""å„ãƒ†ã‚¹ãƒˆé–¢æ•°ã”ã¨ã«DBã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆï¼ˆè‡ªå‹•ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰"""</span>
    connection = engine.connect()
    transaction = connection.begin()
    
    Session = sessionmaker(bind=connection)
    session = Session()
    
    <span class="keyword">yield</span> session  <span class="comment"># ãƒ†ã‚¹ãƒˆã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æ¸¡ã™</span>
    
    <span class="comment"># ãƒ†ã‚¹ãƒˆå¾Œã«ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆãƒ‡ãƒ¼ã‚¿ã‚’å…ƒã«æˆ»ã™ï¼‰</span>
    session.close()
    transaction.rollback()
    connection.close()


<span class="decorator">@pytest.fixture</span>
<span class="keyword">def</span> <span class="function">client</span>(db_session):
    <span class="string">"""APIãƒ†ã‚¹ãƒˆç”¨ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ"""</span>
    <span class="comment"># DBã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’å·®ã—æ›¿ãˆ</span>
    <span class="keyword">def</span> <span class="function">override_get_db</span>():
        <span class="keyword">yield</span> db_session
    
    app.dependency_overrides[get_db] = override_get_db
    
    <span class="keyword">with</span> TestClient(app) <span class="keyword">as</span> c:
        <span class="keyword">yield</span> c
    
    app.dependency_overrides.clear()
            </div>
            
            <h3>Fixtureã®ã‚¹ã‚³ãƒ¼ãƒ—</h3>
            <table>
                <tr>
                    <th>ã‚¹ã‚³ãƒ¼ãƒ—</th>
                    <th>ä½œæˆã‚¿ã‚¤ãƒŸãƒ³ã‚°</th>
                    <th>ç”¨é€”</th>
                </tr>
                <tr>
                    <td><code>function</code>ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰</td>
                    <td>å„ãƒ†ã‚¹ãƒˆé–¢æ•°ã”ã¨</td>
                    <td>DBã‚»ãƒƒã‚·ãƒ§ãƒ³ã€ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿</td>
                </tr>
                <tr>
                    <td><code>class</code></td>
                    <td>å„ãƒ†ã‚¹ãƒˆã‚¯ãƒ©ã‚¹ã”ã¨</td>
                    <td>ã‚¯ãƒ©ã‚¹å˜ä½ã§å…±æœ‰ã™ã‚‹ãƒªã‚½ãƒ¼ã‚¹</td>
                </tr>
                <tr>
                    <td><code>module</code></td>
                    <td>å„ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã”ã¨</td>
                    <td>ãƒ•ã‚¡ã‚¤ãƒ«å˜ä½ã§å…±æœ‰</td>
                </tr>
                <tr>
                    <td><code>session</code></td>
                    <td>ãƒ†ã‚¹ãƒˆå…¨ä½“ã§1å›</td>
                    <td>DBã‚¨ãƒ³ã‚¸ãƒ³ã€å¤–éƒ¨æ¥ç¶š</td>
                </tr>
            </table>
            
            <div class="recommend-box">
                <h4>âœ… Fixtureã®ãƒ¡ãƒªãƒƒãƒˆ</h4>
                <ul>
                    <li><strong>DRY</strong>ï¼šæº–å‚™ã‚³ãƒ¼ãƒ‰ã‚’1ç®‡æ‰€ã«ã¾ã¨ã‚ã‚‹</li>
                    <li><strong>è‡ªå‹•ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—</strong>ï¼š<code>yield</code>å¾Œã«å¾Œå‡¦ç†</li>
                    <li><strong>ä¾å­˜é–¢ä¿‚</strong>ï¼šFixtureåŒå£«ã‚’çµ„ã¿åˆã‚ã›å¯èƒ½</li>
                    <li><strong>å†åˆ©ç”¨</strong>ï¼š<code>conftest.py</code>ã«æ›¸ã‘ã°å…¨ãƒ†ã‚¹ãƒˆã§ä½¿ãˆã‚‹</li>
                </ul>
            </div>
        </div>

        <!-- Factory Boy -->
        <div class="section">
            <h2 class="factory">ğŸ­ 5. Factory Boyï¼ˆãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿è‡ªå‹•ç”Ÿæˆï¼‰</h2>
            
            <p style="margin-bottom: 20px;">
                <strong>Factory Boy</strong>ã¯ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ç°¡å˜ã«ç”Ÿæˆã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚<br>
                <strong>Faker</strong>ã¨çµ„ã¿åˆã‚ã›ã‚‹ã¨ã€ãƒªã‚¢ãƒ«ãªãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•ç”Ÿæˆã§ãã¾ã™ã€‚
            </p>
            
            <h3>ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h3>
            <div class="command-block">
                <span class="prompt">$</span> pip install factory-boy Faker
            </div>
            
            <h3>Factory BoyãŒãªã„å ´åˆã®å•é¡Œ</h3>
            <div class="compare-diagram">
                <div class="compare-side bad">
                    <h4>âŒ æ‰‹å‹•ã§ãƒ‡ãƒ¼ã‚¿ä½œæˆ</h4>
                    <div class="code-block" style="font-size: 11px;">
<span class="keyword">def</span> <span class="function">test_vulnerability</span>(db_session):
    <span class="comment"># æ¯å›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å…¨éƒ¨æ›¸ã...</span>
    vuln = Vulnerability(
        cve_id=<span class="string">"CVE-2024-0001"</span>,
        title=<span class="string">"Test Vulnerability"</span>,
        description=<span class="string">"Test desc"</span>,
        cvss_score=<span class="number">9.8</span>,
        severity=<span class="string">"Critical"</span>,
        published_date=datetime.now(),
        <span class="comment"># ã¾ã ã¾ã ç¶šã...</span>
    )
                    </div>
                    <p style="color: #cf222e; font-weight: 600; margin-top: 8px;">
                        â†’ é¢å€’ã€ãƒ‡ãƒ¼ã‚¿ãŒå˜èª¿
                    </p>
                </div>
                
                <div class="compare-side good">
                    <h4>âœ… Factory Boy</h4>
                    <div class="code-block" style="font-size: 11px;">
<span class="keyword">def</span> <span class="function">test_vulnerability</span>(db_session):
    <span class="comment"># 1è¡Œã§å®Œäº†ï¼</span>
    vuln = VulnerabilityFactory()
    
    <span class="comment"># ç‰¹å®šã®å€¤ã ã‘æŒ‡å®šã‚‚å¯èƒ½</span>
    critical_vuln = VulnerabilityFactory(
        severity=<span class="string">"Critical"</span>
    )
    
    <span class="comment"># 10ä»¶ã¾ã¨ã‚ã¦ä½œæˆ</span>
    vulns = VulnerabilityFactory.create_batch(<span class="number">10</span>)
                    </div>
                    <p style="color: #1a7f37; font-weight: 600; margin-top: 8px;">
                        â†’ ç°¡æ½”ã€å¤šæ§˜ãªãƒ‡ãƒ¼ã‚¿
                    </p>
                </div>
            </div>
            
            <h3>Factoryã®å®šç¾©</h3>
            <div class="code-block">
<span class="comment"># tests/factories.py</span>
<span class="keyword">import</span> factory
<span class="keyword">from</span> factory <span class="keyword">import</span> Faker, LazyAttribute, SubFactory
<span class="keyword">from</span> datetime <span class="keyword">import</span> datetime, timedelta
<span class="keyword">import</span> random

<span class="keyword">from</span> app.models <span class="keyword">import</span> Vulnerability, Asset, VulnerabilityAsset


<span class="keyword">class</span> <span class="class">VulnerabilityFactory</span>(factory.Factory):
    <span class="string">"""è„†å¼±æ€§ã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ"""</span>
    
    <span class="keyword">class</span> <span class="class">Meta</span>:
        model = Vulnerability
    
    <span class="comment"># Fakerã§ãƒªã‚¢ãƒ«ãªãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ</span>
    cve_id = factory.Sequence(<span class="keyword">lambda</span> n: <span class="string">f"CVE-2024-{n:04d}"</span>)
    title = Faker(<span class="string">"sentence"</span>, nb_words=<span class="number">6</span>)
    description = Faker(<span class="string">"paragraph"</span>)
    
    <span class="comment"># ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å€¤</span>
    cvss_score = factory.LazyFunction(
        <span class="keyword">lambda</span>: round(random.uniform(<span class="number">0.0</span>, <span class="number">10.0</span>), <span class="number">1</span>)
    )
    
    <span class="comment"># CVSSã‚¹ã‚³ã‚¢ã«åŸºã¥ã„ã¦è‡ªå‹•è¨ˆç®—</span>
    severity = LazyAttribute(
        <span class="keyword">lambda</span> obj: 
            <span class="string">"Critical"</span> <span class="keyword">if</span> obj.cvss_score >= <span class="number">9.0</span> <span class="keyword">else</span>
            <span class="string">"High"</span> <span class="keyword">if</span> obj.cvss_score >= <span class="number">7.0</span> <span class="keyword">else</span>
            <span class="string">"Medium"</span> <span class="keyword">if</span> obj.cvss_score >= <span class="number">4.0</span> <span class="keyword">else</span>
            <span class="string">"Low"</span>
    )
    
    <span class="comment"># éå»30æ—¥ä»¥å†…ã®ãƒ©ãƒ³ãƒ€ãƒ ãªæ—¥æ™‚</span>
    published_date = factory.LazyFunction(
        <span class="keyword">lambda</span>: datetime.now() - timedelta(days=random.randint(<span class="number">1</span>, <span class="number">30</span>))
    )
    
    is_kev = factory.LazyFunction(<span class="keyword">lambda</span>: random.random() < <span class="number">0.1</span>)  <span class="comment"># 10%ã®ç¢ºç‡ã§True</span>


<span class="keyword">class</span> <span class="class">AssetFactory</span>(factory.Factory):
    <span class="string">"""è³‡ç”£ã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆ"""</span>
    
    <span class="keyword">class</span> <span class="class">Meta</span>:
        model = Asset
    
    hostname = factory.Sequence(<span class="keyword">lambda</span> n: <span class="string">f"server-{n:03d}"</span>)
    ip_address = Faker(<span class="string">"ipv4_private"</span>)
    os_name = factory.LazyFunction(
        <span class="keyword">lambda</span>: random.choice([<span class="string">"Ubuntu 22.04"</span>, <span class="string">"Windows Server 2019"</span>, <span class="string">"RHEL 8"</span>])
    )
    environment = factory.LazyFunction(
        <span class="keyword">lambda</span>: random.choice([<span class="string">"production"</span>, <span class="string">"staging"</span>, <span class="string">"development"</span>])
    )
    criticality = factory.LazyFunction(
        <span class="keyword">lambda</span>: random.choice([<span class="string">"high"</span>, <span class="string">"medium"</span>, <span class="string">"low"</span>])
    )


<span class="keyword">class</span> <span class="class">CriticalVulnerabilityFactory</span>(VulnerabilityFactory):
    <span class="string">"""Criticalè„†å¼±æ€§å°‚ç”¨ï¼ˆVulnerabilityFactoryã‚’ç¶™æ‰¿ï¼‰"""</span>
    cvss_score = factory.LazyFunction(<span class="keyword">lambda</span>: round(random.uniform(<span class="number">9.0</span>, <span class="number">10.0</span>), <span class="number">1</span>))
    severity = <span class="string">"Critical"</span>
    is_kev = <span class="keyword">True</span>
            </div>
            
            <h3>Factoryã®ä½¿ã„æ–¹</h3>
            <div class="code-block">
<span class="comment"># ãƒ†ã‚¹ãƒˆã§ã®ä½¿ç”¨ä¾‹</span>
<span class="keyword">from</span> tests.factories <span class="keyword">import</span> VulnerabilityFactory, AssetFactory

<span class="keyword">def</span> <span class="function">test_vulnerability_list</span>(db_session, client):
    <span class="comment"># 1ä»¶ä½œæˆ</span>
    vuln = VulnerabilityFactory()
    db_session.add(vuln)
    db_session.commit()
    
    <span class="comment"># ç‰¹å®šã®å€¤ã‚’æŒ‡å®š</span>
    critical_vuln = VulnerabilityFactory(
        cve_id=<span class="string">"CVE-2024-9999"</span>,
        severity=<span class="string">"Critical"</span>,
        cvss_score=<span class="number">9.8</span>
    )
    
    <span class="comment"># 10ä»¶ã¾ã¨ã‚ã¦ä½œæˆ</span>
    vulns = VulnerabilityFactory.create_batch(<span class="number">10</span>)
    db_session.add_all(vulns)
    db_session.commit()
    
    <span class="comment"># APIã‚’ãƒ†ã‚¹ãƒˆ</span>
    response = client.get(<span class="string">"/api/vulnerabilities"</span>)
    <span class="keyword">assert</span> <span class="builtin">len</span>(response.json()) == <span class="number">11</span>


<span class="keyword">def</span> <span class="function">test_filter_by_severity</span>(db_session, client):
    <span class="comment"># å„é‡è¦åº¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ</span>
    VulnerabilityFactory(severity=<span class="string">"Critical"</span>, cvss_score=<span class="number">9.5</span>)
    VulnerabilityFactory(severity=<span class="string">"High"</span>, cvss_score=<span class="number">7.5</span>)
    VulnerabilityFactory(severity=<span class="string">"Medium"</span>, cvss_score=<span class="number">5.0</span>)
    db_session.commit()
    
    <span class="comment"># Criticalã®ã¿ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</span>
    response = client.get(<span class="string">"/api/vulnerabilities?severity=Critical"</span>)
    <span class="keyword">assert</span> <span class="builtin">len</span>(response.json()) == <span class="number">1</span>
            </div>
            
            <div class="point-box">
                <h4>ğŸ¯ Factory Boyã®ä¾¿åˆ©æ©Ÿèƒ½</h4>
                <table>
                    <tr>
                        <th>æ©Ÿèƒ½</th>
                        <th>èª¬æ˜</th>
                        <th>ä¾‹</th>
                    </tr>
                    <tr>
                        <td><code>Sequence</code></td>
                        <td>é€£ç•ªã‚’ç”Ÿæˆ</td>
                        <td><code>CVE-2024-0001</code>, <code>0002</code>...</td>
                    </tr>
                    <tr>
                        <td><code>Faker</code></td>
                        <td>ãƒªã‚¢ãƒ«ãªãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿</td>
                        <td>åå‰ã€ä½æ‰€ã€IPã‚¢ãƒ‰ãƒ¬ã‚¹ç­‰</td>
                    </tr>
                    <tr>
                        <td><code>LazyAttribute</code></td>
                        <td>ä»–ã®å€¤ã‹ã‚‰è¨ˆç®—</td>
                        <td>CVSSã‹ã‚‰é‡è¦åº¦ã‚’è‡ªå‹•åˆ¤å®š</td>
                    </tr>
                    <tr>
                        <td><code>SubFactory</code></td>
                        <td>é–¢é€£ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚‚ç”Ÿæˆ</td>
                        <td>è„†å¼±æ€§ã¨è³‡ç”£ã‚’åŒæ™‚ã«</td>
                    </tr>
                    <tr>
                        <td><code>create_batch</code></td>
                        <td>ã¾ã¨ã‚ã¦ç”Ÿæˆ</td>
                        <td>100ä»¶ã®ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿</td>
                    </tr>
                </table>
            </div>
        </div>

        <!-- çµ±åˆãƒ†ã‚¹ãƒˆã®å®Ÿè£… -->
        <div class="section">
            <h2 class="integration">ğŸ”— 6. çµ±åˆãƒ†ã‚¹ãƒˆã®å®Ÿè£…</h2>
            
            <h3>ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ</h3>
            <div class="file-tree">
<span class="folder">tests/</span>
â”œâ”€â”€ <span class="file">conftest.py</span>           <span class="comment"># å…±é€šFixture</span>
â”œâ”€â”€ <span class="file">factories.py</span>          <span class="comment"># Factoryå®šç¾©</span>
â”œâ”€â”€ <span class="folder">unit/</span>                  <span class="comment"># å˜ä½“ãƒ†ã‚¹ãƒˆ</span>
â”‚   â”œâ”€â”€ <span class="file">test_severity.py</span>
â”‚   â””â”€â”€ <span class="file">test_cpe_parser.py</span>
â”œâ”€â”€ <span class="folder">integration/</span>           <span class="comment"># çµ±åˆãƒ†ã‚¹ãƒˆ</span>
â”‚   â”œâ”€â”€ <span class="file">test_api_vulnerabilities.py</span>
â”‚   â”œâ”€â”€ <span class="file">test_api_assets.py</span>
â”‚   â”œâ”€â”€ <span class="file">test_matching.py</span>
â”‚   â””â”€â”€ <span class="file">test_notifications.py</span>
â””â”€â”€ <span class="folder">e2e/</span>                   <span class="comment"># E2Eãƒ†ã‚¹ãƒˆï¼ˆå°†æ¥ï¼‰</span>
    â””â”€â”€ <span class="file">test_dashboard.py</span>
            </div>
            
            <h3>APIçµ±åˆãƒ†ã‚¹ãƒˆã®ä¾‹</h3>
            <div class="code-block">
<span class="comment"># tests/integration/test_api_vulnerabilities.py</span>
<span class="keyword">import</span> pytest
<span class="keyword">from</span> tests.factories <span class="keyword">import</span> VulnerabilityFactory, AssetFactory


<span class="keyword">class</span> <span class="class">TestVulnerabilityAPI</span>:
    <span class="string">"""è„†å¼±æ€§APIã®çµ±åˆãƒ†ã‚¹ãƒˆ"""</span>
    
    <span class="keyword">def</span> <span class="function">test_get_vulnerabilities_empty</span>(self, client):
        <span class="string">"""ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯ç©ºé…åˆ—ã‚’è¿”ã™"""</span>
        response = client.get(<span class="string">"/api/vulnerabilities"</span>)
        
        <span class="keyword">assert</span> response.status_code == <span class="number">200</span>
        <span class="keyword">assert</span> response.json() == []
    
    
    <span class="keyword">def</span> <span class="function">test_get_vulnerabilities_with_data</span>(self, client, db_session):
        <span class="string">"""è„†å¼±æ€§ä¸€è¦§ã‚’å–å¾—"""</span>
        <span class="comment"># ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ</span>
        vulns = VulnerabilityFactory.create_batch(<span class="number">5</span>)
        <span class="keyword">for</span> v <span class="keyword">in</span> vulns:
            db_session.add(v)
        db_session.commit()
        
        <span class="comment"># APIå‘¼ã³å‡ºã—</span>
        response = client.get(<span class="string">"/api/vulnerabilities"</span>)
        
        <span class="comment"># æ¤œè¨¼</span>
        <span class="keyword">assert</span> response.status_code == <span class="number">200</span>
        data = response.json()
        <span class="keyword">assert</span> <span class="builtin">len</span>(data) == <span class="number">5</span>
        <span class="keyword">assert</span> <span class="string">"cve_id"</span> <span class="keyword">in</span> data[<span class="number">0</span>]
    
    
    <span class="keyword">def</span> <span class="function">test_filter_by_severity</span>(self, client, db_session):
        <span class="string">"""é‡è¦åº¦ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼"""</span>
        <span class="comment"># å„é‡è¦åº¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ</span>
        VulnerabilityFactory(severity=<span class="string">"Critical"</span>, cvss_score=<span class="number">9.5</span>)
        VulnerabilityFactory(severity=<span class="string">"Critical"</span>, cvss_score=<span class="number">9.8</span>)
        VulnerabilityFactory(severity=<span class="string">"High"</span>, cvss_score=<span class="number">7.5</span>)
        VulnerabilityFactory(severity=<span class="string">"Medium"</span>, cvss_score=<span class="number">5.0</span>)
        db_session.commit()
        
        <span class="comment"># Criticalã®ã¿ã‚’å–å¾—</span>
        response = client.get(<span class="string">"/api/vulnerabilities?severity=Critical"</span>)
        
        <span class="keyword">assert</span> response.status_code == <span class="number">200</span>
        data = response.json()
        <span class="keyword">assert</span> <span class="builtin">len</span>(data) == <span class="number">2</span>
        <span class="keyword">assert</span> <span class="builtin">all</span>(v[<span class="string">"severity"</span>] == <span class="string">"Critical"</span> <span class="keyword">for</span> v <span class="keyword">in</span> data)
    
    
    <span class="keyword">def</span> <span class="function">test_create_vulnerability</span>(self, client, db_session):
        <span class="string">"""è„†å¼±æ€§ã‚’æ–°è¦ä½œæˆ"""</span>
        payload = {
            <span class="string">"cve_id"</span>: <span class="string">"CVE-2024-9999"</span>,
            <span class="string">"title"</span>: <span class="string">"Test Vulnerability"</span>,
            <span class="string">"cvss_score"</span>: <span class="number">9.8</span>,
            <span class="string">"severity"</span>: <span class="string">"Critical"</span>
        }
        
        response = client.post(<span class="string">"/api/vulnerabilities"</span>, json=payload)
        
        <span class="keyword">assert</span> response.status_code == <span class="number">201</span>
        data = response.json()
        <span class="keyword">assert</span> data[<span class="string">"cve_id"</span>] == <span class="string">"CVE-2024-9999"</span>
        <span class="keyword">assert</span> data[<span class="string">"id"</span>] <span class="keyword">is not</span> <span class="keyword">None</span>
    
    
    <span class="keyword">def</span> <span class="function">test_create_duplicate_cve</span>(self, client, db_session):
        <span class="string">"""é‡è¤‡ã™ã‚‹CVE IDã¯ã‚¨ãƒ©ãƒ¼"""</span>
        <span class="comment"># æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆ</span>
        VulnerabilityFactory(cve_id=<span class="string">"CVE-2024-1111"</span>)
        db_session.commit()
        
        <span class="comment"># åŒã˜CVE IDã§ä½œæˆã‚’è©¦ã¿ã‚‹</span>
        payload = {<span class="string">"cve_id"</span>: <span class="string">"CVE-2024-1111"</span>, <span class="string">"title"</span>: <span class="string">"Duplicate"</span>}
        response = client.post(<span class="string">"/api/vulnerabilities"</span>, json=payload)
        
        <span class="keyword">assert</span> response.status_code == <span class="number">409</span>  <span class="comment"># Conflict</span>
    
    
    <span class="keyword">def</span> <span class="function">test_pagination</span>(self, client, db_session):
        <span class="string">"""ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³"""</span>
        <span class="comment"># 25ä»¶ä½œæˆ</span>
        vulns = VulnerabilityFactory.create_batch(<span class="number">25</span>)
        <span class="keyword">for</span> v <span class="keyword">in</span> vulns:
            db_session.add(v)
        db_session.commit()
        
        <span class="comment"># 1ãƒšãƒ¼ã‚¸ç›®ï¼ˆ10ä»¶ï¼‰</span>
        response = client.get(<span class="string">"/api/vulnerabilities?page=1&amp;per_page=10"</span>)
        <span class="keyword">assert</span> <span class="builtin">len</span>(response.json()) == <span class="number">10</span>
        
        <span class="comment"># 3ãƒšãƒ¼ã‚¸ç›®ï¼ˆ5ä»¶ï¼‰</span>
        response = client.get(<span class="string">"/api/vulnerabilities?page=3&amp;per_page=10"</span>)
        <span class="keyword">assert</span> <span class="builtin">len</span>(response.json()) == <span class="number">5</span>
            </div>
            
            <h3>ãƒãƒƒãƒãƒ³ã‚°ã‚¨ãƒ³ã‚¸ãƒ³ã®çµ±åˆãƒ†ã‚¹ãƒˆ</h3>
            <div class="code-block">
<span class="comment"># tests/integration/test_matching.py</span>
<span class="keyword">import</span> pytest
<span class="keyword">from</span> app.services.matching_engine <span class="keyword">import</span> MatchingEngine
<span class="keyword">from</span> tests.factories <span class="keyword">import</span> VulnerabilityFactory, AssetFactory


<span class="keyword">class</span> <span class="class">TestMatchingEngine</span>:
    <span class="string">"""è„†å¼±æ€§ã¨è³‡ç”£ã®ãƒãƒƒãƒãƒ³ã‚°ãƒ†ã‚¹ãƒˆ"""</span>
    
    <span class="keyword">def</span> <span class="function">test_match_by_cpe</span>(self, db_session):
        <span class="string">"""CPEã§ãƒãƒƒãƒãƒ³ã‚°"""</span>
        <span class="comment"># Apacheè„†å¼±æ€§ã‚’ä½œæˆ</span>
        vuln = VulnerabilityFactory(
            cve_id=<span class="string">"CVE-2024-1234"</span>,
            cpe=<span class="string">"cpe:2.3:a:apache:http_server:2.4.49:*:*:*:*:*:*:*"</span>
        )
        
        <span class="comment"># ApacheãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸè³‡ç”£</span>
        asset = AssetFactory(
            hostname=<span class="string">"web-server-01"</span>,
            installed_software=[
                {<span class="string">"name"</span>: <span class="string">"apache"</span>, <span class="string">"version"</span>: <span class="string">"2.4.49"</span>}
            ]
        )
        
        db_session.add_all([vuln, asset])
        db_session.commit()
        
        <span class="comment"># ãƒãƒƒãƒãƒ³ã‚°å®Ÿè¡Œ</span>
        engine = MatchingEngine(db_session)
        matches = engine.find_matches(vuln)
        
        <span class="comment"># æ¤œè¨¼</span>
        <span class="keyword">assert</span> <span class="builtin">len</span>(matches) == <span class="number">1</span>
        <span class="keyword">assert</span> matches[<span class="number">0</span>].asset.hostname == <span class="string">"web-server-01"</span>
    
    
    <span class="keyword">def</span> <span class="function">test_no_match_different_version</span>(self, db_session):
        <span class="string">"""ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒé•ãˆã°ãƒãƒƒãƒã—ãªã„"""</span>
        vuln = VulnerabilityFactory(
            cpe=<span class="string">"cpe:2.3:a:apache:http_server:2.4.49:*:*:*:*:*:*:*"</span>
        )
        asset = AssetFactory(
            installed_software=[
                {<span class="string">"name"</span>: <span class="string">"apache"</span>, <span class="string">"version"</span>: <span class="string">"2.4.50"</span>}  <span class="comment"># é•ã†ãƒãƒ¼ã‚¸ãƒ§ãƒ³</span>
            ]
        )
        
        db_session.add_all([vuln, asset])
        db_session.commit()
        
        engine = MatchingEngine(db_session)
        matches = engine.find_matches(vuln)
        
        <span class="keyword">assert</span> <span class="builtin">len</span>(matches) == <span class="number">0</span>  <span class="comment"># ãƒãƒƒãƒãªã—</span>
    
    
    <span class="keyword">def</span> <span class="function">test_priority_calculation</span>(self, db_session):
        <span class="string">"""å„ªå…ˆåº¦è¨ˆç®—ã®ãƒ†ã‚¹ãƒˆ"""</span>
        <span class="comment"># Critical + KEV + æœ¬ç•ªç’°å¢ƒ â†’ Immediate</span>
        vuln = VulnerabilityFactory(
            cvss_score=<span class="number">9.8</span>,
            severity=<span class="string">"Critical"</span>,
            is_kev=<span class="keyword">True</span>
        )
        asset = AssetFactory(
            environment=<span class="string">"production"</span>,
            criticality=<span class="string">"high"</span>
        )
        
        db_session.add_all([vuln, asset])
        db_session.commit()
        
        engine = MatchingEngine(db_session)
        priority = engine.calculate_priority(vuln, asset)
        
        <span class="keyword">assert</span> priority == <span class="string">"Immediate"</span>
            </div>
            
            <h3>é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹ã®çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆãƒ¢ãƒƒã‚¯ä½¿ç”¨ï¼‰</h3>
            <div class="code-block">
<span class="comment"># tests/integration/test_notifications.py</span>
<span class="keyword">import</span> pytest
<span class="keyword">from</span> unittest.mock <span class="keyword">import</span> Mock, patch
<span class="keyword">from</span> app.services.notification_service <span class="keyword">import</span> NotificationService
<span class="keyword">from</span> tests.factories <span class="keyword">import</span> VulnerabilityFactory


<span class="keyword">class</span> <span class="class">TestNotificationService</span>:
    <span class="string">"""é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ†ã‚¹ãƒˆ"""</span>
    
    <span class="decorator">@patch</span>(<span class="string">"app.services.notification_service.requests.post"</span>)
    <span class="keyword">def</span> <span class="function">test_send_slack_notification</span>(self, mock_post, db_session):
        <span class="string">"""Slacké€šçŸ¥ãŒæ­£ã—ãé€ä¿¡ã•ã‚Œã‚‹"""</span>
        <span class="comment"># ãƒ¢ãƒƒã‚¯ã®è¨­å®š</span>
        mock_post.return_value.status_code = <span class="number">200</span>
        mock_post.return_value.ok = <span class="keyword">True</span>
        
        <span class="comment"># ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿</span>
        vuln = VulnerabilityFactory(
            cve_id=<span class="string">"CVE-2024-1234"</span>,
            severity=<span class="string">"Critical"</span>
        )
        
        <span class="comment"># é€šçŸ¥é€ä¿¡</span>
        service = NotificationService()
        result = service.send_slack_alert(vuln)
        
        <span class="comment"># æ¤œè¨¼</span>
        <span class="keyword">assert</span> result <span class="keyword">is</span> <span class="keyword">True</span>
        mock_post.assert_called_once()
        
        <span class="comment"># é€ä¿¡å†…å®¹ã‚’æ¤œè¨¼</span>
        call_args = mock_post.call_args
        payload = call_args.kwargs[<span class="string">"json"</span>]
        <span class="keyword">assert</span> <span class="string">"CVE-2024-1234"</span> <span class="keyword">in</span> <span class="builtin">str</span>(payload)
        <span class="keyword">assert</span> <span class="string">"Critical"</span> <span class="keyword">in</span> <span class="builtin">str</span>(payload)
    
    
    <span class="decorator">@patch</span>(<span class="string">"app.services.notification_service.requests.post"</span>)
    <span class="keyword">def</span> <span class="function">test_notification_failure_handling</span>(self, mock_post, db_session):
        <span class="string">"""é€šçŸ¥å¤±æ•—æ™‚ã®ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°"""</span>
        <span class="comment"># å¤±æ•—ã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</span>
        mock_post.return_value.status_code = <span class="number">500</span>
        mock_post.return_value.ok = <span class="keyword">False</span>
        
        vuln = VulnerabilityFactory()
        
        service = NotificationService()
        result = service.send_slack_alert(vuln)
        
        <span class="keyword">assert</span> result <span class="keyword">is</span> <span class="keyword">False</span>
            </div>
            
            <div class="callout">
                å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆSlackã€Teamsç­‰ï¼‰ã¸ã®é€šä¿¡ã¯<strong>ãƒ¢ãƒƒã‚¯</strong>ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚<br>
                å®Ÿéš›ã®APIã‚’å‘¼ã°ãšã«ã€é€ä¿¡å†…å®¹ã¨å‹•ä½œã‚’æ¤œè¨¼ã§ãã¾ã™ã€‚
            </div>
        </div>

        <!-- åŠ¹ç‡åŒ–ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ -->
        <div class="section">
            <h2 class="efficiency">âš¡ 7. åŠ¹ç‡åŒ–ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯</h2>
            
            <h3>â‘  ä¸¦åˆ—å®Ÿè¡Œï¼ˆpytest-xdistï¼‰</h3>
            <p style="margin-bottom: 12px;">
                ãƒ†ã‚¹ãƒˆã‚’ä¸¦åˆ—å®Ÿè¡Œã™ã‚‹ã¨ã€å®Ÿè¡Œæ™‚é–“ã‚’å¤§å¹…ã«çŸ­ç¸®ã§ãã¾ã™ã€‚
            </p>
            
            <div class="command-block">
                <span class="comment"># ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</span><br>
                <span class="prompt">$</span> pip install pytest-xdist<br>
                <br>
                <span class="comment"># 4ä¸¦åˆ—ã§å®Ÿè¡Œ</span><br>
                <span class="prompt">$</span> pytest -n 4<br>
                <br>
                <span class="comment"># CPUæ•°ã«å¿œã˜ã¦è‡ªå‹•èª¿æ•´</span><br>
                <span class="prompt">$</span> pytest -n auto
            </div>
            
            <h4>åŠ¹æœ</h4>
            <div style="max-width: 500px;">
                <div class="time-bar">
                    <div class="time-bar-label">é€šå¸¸å®Ÿè¡Œ</div>
                    <div class="time-bar-visual">
                        <div class="time-bar-fill slow" style="width: 100%;">4åˆ†</div>
                    </div>
                </div>
                <div class="time-bar">
                    <div class="time-bar-label">4ä¸¦åˆ—å®Ÿè¡Œ</div>
                    <div class="time-bar-visual">
                        <div class="time-bar-fill fast" style="width: 25%;">1åˆ†</div>
                    </div>
                </div>
            </div>
            
            <h3>â‘¡ ã‚«ãƒãƒ¬ãƒƒã‚¸è¨ˆæ¸¬ï¼ˆpytest-covï¼‰</h3>
            <p style="margin-bottom: 12px;">
                ãƒ†ã‚¹ãƒˆãŒã‚³ãƒ¼ãƒ‰ã®ã©ã‚Œã ã‘ã‚’ã‚«ãƒãƒ¼ã—ã¦ã„ã‚‹ã‹æ¸¬å®šã—ã¾ã™ã€‚
            </p>
            
            <div class="command-block">
                <span class="comment"># ã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ãã§å®Ÿè¡Œ</span><br>
                <span class="prompt">$</span> pytest --cov=app --cov-report=html<br>
                <span class="output">
---------- coverage: ... ----------
Name                      Stmts   Miss  Cover
---------------------------------------------
app/main.py                  45      3    93%
app/models.py                62      5    92%
app/services/matching.py     98     12    88%
---------------------------------------------
TOTAL                       205     20    90%
                </span>
            </div>
            
            <div class="recommend-box">
                <h4>âœ… ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™</h4>
                <ul>
                    <li><strong>80%ä»¥ä¸Š</strong>ï¼šä¸€èˆ¬çš„ãªç›®æ¨™</li>
                    <li><strong>90%ä»¥ä¸Š</strong>ï¼šé«˜å“è³ªãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ</li>
                    <li><strong>100%</strong>ï¼šç¾å®Ÿçš„ã«ã¯ä¸è¦ï¼ˆã‚³ã‚¹ãƒˆé«˜ï¼‰</li>
                </ul>
                <p style="margin-top: 8px;">
                    é‡è¦ãªã®ã¯ã€Œé‡è¦ãªéƒ¨åˆ†ã€ã‚’ã‚«ãƒãƒ¼ã™ã‚‹ã“ã¨ã€‚æ•°å­—ã ã‘ã‚’è¿½ã‚ãªã„ã€‚
                </p>
            </div>
            
            <h3>â‘¢ ãƒ†ã‚¹ãƒˆã®ãƒãƒ¼ã‚«ãƒ¼</h3>
            <p style="margin-bottom: 12px;">
                ãƒ†ã‚¹ãƒˆã‚’åˆ†é¡ã—ã¦ã€å¿…è¦ãªã‚‚ã®ã ã‘å®Ÿè¡Œã§ãã¾ã™ã€‚
            </p>
            
            <div class="code-block">
<span class="comment"># pytest.ini</span>
[pytest]
markers =
    slow: æ™‚é–“ã®ã‹ã‹ã‚‹ãƒ†ã‚¹ãƒˆ
    integration: çµ±åˆãƒ†ã‚¹ãƒˆ
    unit: å˜ä½“ãƒ†ã‚¹ãƒˆ
            </div>
            
            <div class="code-block">
<span class="comment"># ãƒ†ã‚¹ãƒˆã«ãƒãƒ¼ã‚«ãƒ¼ã‚’ä»˜ã‘ã‚‹</span>
<span class="keyword">import</span> pytest

<span class="decorator">@pytest.mark.unit</span>
<span class="keyword">def</span> <span class="function">test_calculate_severity</span>():
    ...

<span class="decorator">@pytest.mark.integration</span>
<span class="keyword">def</span> <span class="function">test_api_get_vulnerabilities</span>():
    ...

<span class="decorator">@pytest.mark.slow</span>
<span class="keyword">def</span> <span class="function">test_full_sync</span>():
    ...
            </div>
            
            <div class="command-block">
                <span class="comment"># å˜ä½“ãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œï¼ˆé€Ÿã„ï¼‰</span><br>
                <span class="prompt">$</span> pytest -m unit<br>
                <br>
                <span class="comment"># çµ±åˆãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ</span><br>
                <span class="prompt">$</span> pytest -m integration<br>
                <br>
                <span class="comment"># slowã‚’é™¤å¤–ã—ã¦å®Ÿè¡Œ</span><br>
                <span class="prompt">$</span> pytest -m "not slow"
            </div>
            
            <h3>â‘£ CIé€£æºï¼ˆGitHub Actionsï¼‰</h3>
            <div class="code-block">
<span class="comment"># .github/workflows/test.yml</span>
<span class="keyword">name</span>: Test

<span class="keyword">on</span>:
  <span class="keyword">pull_request</span>:
    <span class="keyword">branches</span>: [main, develop]

<span class="keyword">jobs</span>:
  <span class="keyword">test</span>:
    <span class="keyword">runs-on</span>: ubuntu-latest
    
    <span class="keyword">services</span>:
      <span class="keyword">postgres</span>:
        <span class="keyword">image</span>: postgres:<span class="number">15</span>
        <span class="keyword">env</span>:
          POSTGRES_USER: test
          POSTGRES_PASSWORD: test
          POSTGRES_DB: test_db
        <span class="keyword">ports</span>:
          - <span class="number">5432</span>:<span class="number">5432</span>
    
    <span class="keyword">steps</span>:
      - <span class="keyword">uses</span>: actions/checkout@v4
      
      - <span class="keyword">name</span>: Set up Python
        <span class="keyword">uses</span>: actions/setup-python@v5
        <span class="keyword">with</span>:
          <span class="keyword">python-version</span>: <span class="string">'3.11'</span>
      
      - <span class="keyword">name</span>: Install dependencies
        <span class="keyword">run</span>: pip install -r requirements.txt
      
      - <span class="keyword">name</span>: Run tests
        <span class="keyword">env</span>:
          DATABASE_URL: postgresql://test:test@localhost:5432/test_db
        <span class="keyword">run</span>: |
          pytest -n auto --cov=app --cov-report=xml
      
      - <span class="keyword">name</span>: Upload coverage
        <span class="keyword">uses</span>: codecov/codecov-action@v3
            </div>
            
            <div class="flow-container">
                <div class="flow-step">
                    ğŸ“¤ PRã‚’ä½œæˆ
                </div>
                <div class="flow-arrow">â†’</div>
                <div class="flow-step highlight">
                    ğŸ§ª è‡ªå‹•ãƒ†ã‚¹ãƒˆ
                </div>
                <div class="flow-arrow">â†’</div>
                <div class="flow-step success">
                    âœ… or âŒ
                </div>
                <div class="flow-arrow">â†’</div>
                <div class="flow-step">
                    ğŸ”€ ãƒãƒ¼ã‚¸
                </div>
            </div>
        </div>

        <!-- æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®é©ç”¨ -->
        <div class="section">
            <h2>ğŸ“ 8. æœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¸ã®é©ç”¨</h2>
            
            <h3>ãƒ†ã‚¹ãƒˆå¯¾è±¡ã¨å„ªå…ˆé †ä½</h3>
            <table>
                <tr>
                    <th>æ©Ÿèƒ½</th>
                    <th>ãƒ†ã‚¹ãƒˆç¨®é¡</th>
                    <th>å„ªå…ˆåº¦</th>
                    <th>ãƒ†ã‚¹ãƒˆå†…å®¹</th>
                </tr>
                <tr>
                    <td><strong>è„†å¼±æ€§API</strong></td>
                    <td>çµ±åˆ</td>
                    <td>ğŸ”´ é«˜</td>
                    <td>CRUDã€ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã€ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³</td>
                </tr>
                <tr>
                    <td><strong>ãƒãƒƒãƒãƒ³ã‚°ã‚¨ãƒ³ã‚¸ãƒ³</strong></td>
                    <td>çµ±åˆ</td>
                    <td>ğŸ”´ é«˜</td>
                    <td>CPEãƒãƒƒãƒãƒ³ã‚°ã€å„ªå…ˆåº¦è¨ˆç®—</td>
                </tr>
                <tr>
                    <td><strong>å„ªå…ˆåº¦è¨ˆç®—</strong></td>
                    <td>å˜ä½“</td>
                    <td>ğŸ”´ é«˜</td>
                    <td>CVSSã€KEVã€ç’°å¢ƒã®çµ„ã¿åˆã‚ã›</td>
                </tr>
                <tr>
                    <td><strong>JVN APIé€£æº</strong></td>
                    <td>çµ±åˆï¼ˆãƒ¢ãƒƒã‚¯ï¼‰</td>
                    <td>ğŸŸ¡ ä¸­</td>
                    <td>ãƒ‡ãƒ¼ã‚¿å–å¾—ã€ãƒ‘ãƒ¼ã‚¹ã€ä¿å­˜</td>
                </tr>
                <tr>
                    <td><strong>é€šçŸ¥ã‚µãƒ¼ãƒ“ã‚¹</strong></td>
                    <td>çµ±åˆï¼ˆãƒ¢ãƒƒã‚¯ï¼‰</td>
                    <td>ğŸŸ¡ ä¸­</td>
                    <td>Slack/Teamsé€ä¿¡ã€æ¡ä»¶ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼</td>
                </tr>
                <tr>
                    <td><strong>ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</strong></td>
                    <td>çµ±åˆ</td>
                    <td>ğŸŸ¡ ä¸­</td>
                    <td>HTML/CSV/PDFå‡ºåŠ›</td>
                </tr>
                <tr>
                    <td><strong>ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</strong></td>
                    <td>E2E</td>
                    <td>ğŸŸ¢ ä½</td>
                    <td>ä¸»è¦ã‚·ãƒŠãƒªã‚ªã®ã¿</td>
                </tr>
            </table>
            
            <h3>ãƒ†ã‚¹ãƒˆæ•°ã®ç›®å®‰</h3>
            <table>
                <tr>
                    <th>ãƒ†ã‚¹ãƒˆç¨®é¡</th>
                    <th>ç›®æ¨™ä»¶æ•°</th>
                    <th>Sprint</th>
                </tr>
                <tr>
                    <td>å˜ä½“ãƒ†ã‚¹ãƒˆ</td>
                    <td>100ã€œ150ä»¶</td>
                    <td>å„æ©Ÿèƒ½å®Ÿè£…ã¨åŒæ™‚</td>
                </tr>
                <tr>
                    <td>çµ±åˆãƒ†ã‚¹ãƒˆ</td>
                    <td>30ã€œ50ä»¶</td>
                    <td>Sprint 3-4</td>
                </tr>
                <tr>
                    <td>E2Eãƒ†ã‚¹ãƒˆ</td>
                    <td>5ã€œ10ä»¶</td>
                    <td>Sprint 5</td>
                </tr>
            </table>
            
            <h3>å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆrequirements-test.txtï¼‰</h3>
            <div class="code-block">
<span class="comment"># requirements-test.txt</span>
pytest==<span class="number">8.0.0</span>
pytest-cov==<span class="number">4.1.0</span>
pytest-xdist==<span class="number">3.5.0</span>
pytest-asyncio==<span class="number">0.23.0</span>
factory-boy==<span class="number">3.3.0</span>
Faker==<span class="number">22.0.0</span>
httpx==<span class="number">0.26.0</span>           <span class="comment"># FastAPI TestClientç”¨</span>
            </div>
            
            <h3>pytestè¨­å®šï¼ˆpyproject.tomlï¼‰</h3>
            <div class="code-block">
<span class="comment"># pyproject.toml</span>
[tool.pytest.ini_options]
testpaths = [<span class="string">"tests"</span>]
python_files = [<span class="string">"test_*.py"</span>]
python_functions = [<span class="string">"test_*"</span>]
addopts = <span class="string">"-v --tb=short"</span>
markers = [
    <span class="string">"unit: å˜ä½“ãƒ†ã‚¹ãƒˆ"</span>,
    <span class="string">"integration: çµ±åˆãƒ†ã‚¹ãƒˆ"</span>,
    <span class="string">"slow: æ™‚é–“ã®ã‹ã‹ã‚‹ãƒ†ã‚¹ãƒˆ"</span>,
]

[tool.coverage.run]
source = [<span class="string">"app"</span>]
omit = [<span class="string">"*/tests/*"</span>, <span class="string">"*/__pycache__/*"</span>]

[tool.coverage.report]
exclude_lines = [
    <span class="string">"pragma: no cover"</span>,
    <span class="string">"if TYPE_CHECKING:"</span>,
    <span class="string">"raise NotImplementedError"</span>,
]
            </div>
        </div>

        <!-- æ‹…å½“ã‚¿ã‚¹ã‚¯ -->
        <div class="section">
            <h2>ğŸ“‹ ãƒ†ã‚¹ãƒˆæ‹…å½“ã‚¿ã‚¹ã‚¯</h2>
            
            <table>
                <tr>
                    <th>Sprint</th>
                    <th>æ‹…å½“</th>
                    <th>ã‚¿ã‚¹ã‚¯</th>
                </tr>
                <tr>
                    <td><strong>Sprint 1</strong></td>
                    <td>ãƒªãƒ¼ãƒ‰</td>
                    <td>
                        ãƒ»ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—<br>
                        ãƒ»conftest.pyä½œæˆï¼ˆå…±é€šFixtureï¼‰<br>
                        ãƒ»factories.pyä½œæˆï¼ˆåŸºæœ¬Factoryï¼‰<br>
                        ãƒ»CIè¨­å®šï¼ˆGitHub Actionsï¼‰
                    </td>
                </tr>
                <tr>
                    <td><strong>Sprint 2-4</strong></td>
                    <td>å„æ‹…å½“</td>
                    <td>
                        ãƒ»å®Ÿè£…ã—ãŸæ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆã‚’åŒæ™‚ã«ä½œæˆ<br>
                        ãƒ»Factoryè¿½åŠ ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰<br>
                        ãƒ»ã‚«ãƒãƒ¬ãƒƒã‚¸80%ä»¥ä¸Šã‚’ç¶­æŒ
                    </td>
                </tr>
                <tr>
                    <td><strong>Sprint 5</strong></td>
                    <td>å…¨å“¡</td>
                    <td>
                        ãƒ»çµ±åˆãƒ†ã‚¹ãƒˆè¿½åŠ <br>
                        ãƒ»E2Eãƒ†ã‚¹ãƒˆï¼ˆä¸»è¦ã‚·ãƒŠãƒªã‚ªï¼‰<br>
                        ãƒ»ãƒ†ã‚¹ãƒˆè¦‹ç›´ã—ãƒ»ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°
                    </td>
                </tr>
            </table>
            
            <div class="recommend-box">
                <h4>âœ… ãƒ†ã‚¹ãƒˆã‚’åŠ¹ç‡çš„ã«é€²ã‚ã‚‹ã‚³ãƒ„</h4>
                <ol style="margin-left: 20px;">
                    <li><strong>å®Ÿè£…ã¨åŒæ™‚ã«ãƒ†ã‚¹ãƒˆ</strong>ï¼šå¾Œå›ã—ã«ã—ãªã„</li>
                    <li><strong>Factoryã‚’æ´»ç”¨</strong>ï¼šãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆã‚’è‡ªå‹•åŒ–</li>
                    <li><strong>Fixtureã§å…±é€šåŒ–</strong>ï¼šæº–å‚™ã‚³ãƒ¼ãƒ‰ã®é‡è¤‡ã‚’æ’é™¤</li>
                    <li><strong>CIã§è‡ªå‹•å®Ÿè¡Œ</strong>ï¼šæ‰‹å‹•ãƒ†ã‚¹ãƒˆã‚’ã‚¼ãƒ­ã«</li>
                    <li><strong>ä¸¦åˆ—å®Ÿè¡Œ</strong>ï¼šå¾…ã¡æ™‚é–“ã‚’çŸ­ç¸®</li>
                </ol>
            </div>
        </div>

        <!-- ã¾ã¨ã‚ -->
        <div class="section">
            <h2>ğŸ“ ã¾ã¨ã‚</h2>
            
            <table>
                <tr>
                    <th style="width: 25%;">é …ç›®</th>
                    <th>ãƒã‚¤ãƒ³ãƒˆ</th>
                </tr>
                <tr>
                    <td><strong>ãƒ†ã‚¹ãƒˆæˆ¦ç•¥</strong></td>
                    <td>ãƒ”ãƒ©ãƒŸãƒƒãƒ‰å‹ï¼ˆå˜ä½“70%ã€çµ±åˆ20%ã€E2E10%ï¼‰</td>
                </tr>
                <tr>
                    <td><strong>ãƒ„ãƒ¼ãƒ«</strong></td>
                    <td>pytest + Factory Boy + pytest-cov + pytest-xdist</td>
                </tr>
                <tr>
                    <td><strong>åŠ¹ç‡åŒ–</strong></td>
                    <td>Fixtureï¼ˆå†åˆ©ç”¨ï¼‰ã€Factoryï¼ˆè‡ªå‹•ç”Ÿæˆï¼‰ã€ä¸¦åˆ—å®Ÿè¡Œ</td>
                </tr>
                <tr>
                    <td><strong>è‡ªå‹•åŒ–</strong></td>
                    <td>GitHub Actionsã§PRæ™‚ã«è‡ªå‹•ãƒ†ã‚¹ãƒˆ</td>
                </tr>
                <tr>
                    <td><strong>æ±ç”¨æ€§</strong></td>
                    <td>conftest.pyã€factories.pyã¯ä»–ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚‚å†åˆ©ç”¨å¯èƒ½</td>
                </tr>
            </table>
            
            <div class="point-box">
                <h4>ğŸ¯ ä»Šå¾Œã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚‚ä½¿ãˆã‚‹ä»•çµ„ã¿</h4>
                <ul>
                    <li><strong>conftest.py</strong>ï¼šDBæ¥ç¶šã€APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®Fixture</li>
                    <li><strong>factories.py</strong>ï¼šãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆã®ãƒ‘ã‚¿ãƒ¼ãƒ³</li>
                    <li><strong>pytestè¨­å®š</strong>ï¼špyproject.tomlã®è¨­å®š</li>
                    <li><strong>CIè¨­å®š</strong>ï¼šGitHub Actionsã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼</li>
                </ul>
                <p style="margin-top: 8px;">
                    ä¸€åº¦ä½œã‚Œã°ã€æ¬¡ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯<strong>ã‚³ãƒ”ãƒ¼&èª¿æ•´</strong>ã™ã‚‹ã ã‘ï¼
                </p>
            </div>
        </div>

        <!-- å‚è€ƒãƒªãƒ³ã‚¯ -->
        <div class="section">
            <h2>ğŸ”— å‚è€ƒãƒªãƒ³ã‚¯</h2>
            
            <table>
                <tr>
                    <th style="width: 30%;">ãƒªã‚½ãƒ¼ã‚¹</th>
                    <th>URL</th>
                </tr>
                <tr>
                    <td><strong>pytestå…¬å¼</strong></td>
                    <td><a href="https://docs.pytest.org/" target="_blank">https://docs.pytest.org/</a></td>
                </tr>
                <tr>
                    <td><strong>Factory Boy</strong></td>
                    <td><a href="https://factoryboy.readthedocs.io/" target="_blank">https://factoryboy.readthedocs.io/</a></td>
                </tr>
                <tr>
                    <td><strong>Faker</strong></td>
                    <td><a href="https://faker.readthedocs.io/" target="_blank">https://faker.readthedocs.io/</a></td>
                </tr>
                <tr>
                    <td><strong>pytest-cov</strong></td>
                    <td><a href="https://pytest-cov.readthedocs.io/" target="_blank">https://pytest-cov.readthedocs.io/</a></td>
                </tr>
                <tr>
                    <td><strong>FastAPI Testing</strong></td>
                    <td><a href="https://fastapi.tiangolo.com/tutorial/testing/" target="_blank">https://fastapi.tiangolo.com/tutorial/testing/</a></td>
                </tr>
            </table>
        </div>

        <div style="text-align: center; color: #57606a; margin-top: 30px; padding: 20px;">
            <p>è„†å¼±æ€§ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ é–‹ç™ºãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ ãƒãƒ¼ãƒ å‘ã‘è³‡æ–™</p>
        </div>
    </div>
</body>
</html>
